= My first website starter

A step-by-step tutorial for building your first website with Enonic XP

WARN: This guide is under construction, do not use

image::images/ready-set-code.jpg["Ready...Set...Code!", width=500px]


== Introduction

This guide will take you through the steps of creating a site, using the basic building blocks of Enonic XP.

During this exercise you will:

* create new project using the starter
* Learn about content types
* Define pages and parts
* TODO more?


== Create project

Visit the https://developer.enonic.com/start[Getting started guide] and complete the setup process:

* Step 1: If you have already installed CLI, you may skip this step
* Step 2: Choose "My First Website" starter
* Wrapping up: Install the apps from the Welcome tour, we will need some of them later on.

NOTE: If XP tour does not start automatically, simply click the top left icon on the home screen

You should now have an XP sandbox and the application running on http://localhost:8080

[NOTE]
====
To verify that your app started successfully, you should find an entry similar to this in the sandbox log:

  2019-04-09 13:40:40,765 INFO ... Application [<my.project.name>] installed successfully
====

The project folder created should now contain a project structure, looking something like this:

[source,files]
----
sample-code/ <!--1-->
docs/ <!--2-->
src/
  main/
    java/ <!--3-->
    resources/ <!--4-->
      import/ <!--5-->
      assets/
      services/
      sites/
        content-types/ <!--6-->
          country/
          city/
        site.xml <!--7-->
----

<1> Holds sample code we will use throughout this tutorial
<2> Contains the documentation you are reading now
<3> Optional folder for Java code (used to import sample site in this starter)
<4> Main location for XP specific project code
<5> The sample site data are located here and imported when the app starts
<6> The starter ships with two content types, country and city
<7> Site descriptor, specifying this is a site app

NOTE: The various "gradle" files on project root are used by the build system to produce the application executable.


== Sample Site

For convenience, the starter includes a `Hello World` sample site with some relevant content (countries and cities).
The items are imported the first time the application starts.

To see the site and content, launch `Content Studio` by selecting it from the main menu in XP's admin console:

[NOTE]
====
If you cannot see Content Studio in the menu, it has not been installed.
Install it through the Welcome tour, or install directly from the `Applications` app found in the main menu.
====

image::images/sample-content.png["Tree structure showing countries and cities in Content Studio", width=734px]

== Content Types

Every item created content studio is based on a specific content type.
Content types are the basic building blocks of the XP CMS.

XP ships with a set of standard content types such as `Site`, `Folder` and a set of specialized types to handle files, also called `Media Types`.

Apps may contain custom content types.
In our case, the conten types `Country` and `City` are pre-defined in the starter.

The Content types definition files are located in your project folder under `src/main/resources/site/content-types`

Every content type must have its own folder and a corresponding xml descriptor file.

The City content type looks something like this for an editor:

image::images/city-cty.png["Form for the city content type", width=820px]

While the descriptor file looks like this:

.src/main/resources/site/content-types/city/city.xml
[source,xml]
----
include::../src/main/resources/site/content-types/city/city.xml[]
----

More information about https://developer.enonic.com/docs/xp/stable/cms/content-types[Content types] and the https://developer.enonic.com/docs/xp/stable/cms/schemas[schema system] are available in the https://developer.enonic.com/docs/xp/[XP reference documentation].

NOTE: XP also offers a way to serve raw content through an API, check out the

== Pages

Page components are the most basic building blocks of websites in XP.
All components require at least a JavaScript controller and optionally an XML descriptor.

Our first example will only use a controller.

A page controller (see http://docs.enonic.com/en/stable/developer/site/page/index.html#page[Page]) is a JavaScript file that handles requests such as *GET* and *POST*.
Controllers usually pass data in the form of a JavaScript object to be dynamically rendered in an HTML view. No data is passed in the
example below, but the view file is specified and rendered as static HTML.

. Create a folder called `hello` inside the `site/pages` directory.

. Create the page controller and page view files specified below inside the `hello` folder:
+
[source,javascript]
----
include::../src/main/resources/site/pages/hello/hello.js[]
----
+

The `view`  below is a simple HTML file. This file will be updated later to handle dynamic content.

+
[source,HTML]
----
include::../src/main/resources/site/pages/hello/hello.html[]
----
+

. Once these files are in place, redeploy the app from the terminal with `./gradlew deploy`.

NOTE: Each page controller must reside in its own folder under the `site/pages` directory. The name of the controller JavaScript file
  must be the same as the directory that contains it. The HTML view file can reside anywhere in the project and have any valid file name.
  This allows view files to be shared between components.

=== Parts

We also need a way to display the data from our *Country* content type. This time, rather than making another page controller, we will create a http://docs.enonic.com/en/stable/developer/site/part/index.html#part[Part] component. *Parts are reusable components* that can be added to _regions_ in pages or layout components - more on this later.

. Create a folder called _country_ inside the _parts_ folder in your project.
. Add the part controller and view files inside the _country_ folder:

+
.Country part controller:
[source,Javascript]
----
include::../src/main/resources/site/parts/country/country.js[]
----
+

The part controller file above handles the *GET* request and passes the country content data to the view file which is shown below.

+
.Country part view:
[source,HTML]
----
include::../src/main/resources/site/parts/country/country.html[]
----
+


=== Regions

Parts start to make sense when placed into a _region_. Regions are “slots” contained within pages or layouts. Pages and layouts may contain multiple regions, and each region must have a unique name.

Let’s create a new page component with a single region called _Main_. Later we will use the *Content Studio* to place the _Country_ part into this region.

The benefit of a region (see http://docs.enonic.com/en/stable/developer/site/page/index.html#apps-page-regions[Regions]) is that a page component can be re-used across multiple different pages by simply adding different parts to them as needed.

. Create a folder called _hello-region_ in your `project’s site/pages/` folder.
. Add the _Hello region_ page descriptor, controller and view files:

+
.Page descriptor:
[source,XML]
----
include::../src/main/resources/site/pages/hello-region/hello-region.xml[]
----
+

The XML file above is a http://docs.enonic.com/en/stable/developer/site/page/index.html#apps-page-descriptor[Descriptor]. Regions and page configurations can be defined here.

+
.Page controller:
[source,Javascript]
----
include::../src/main/resources/site/pages/hello-region/hello-region.js[]
----
+

This page controller uses a portal library (see `lib-portal` in http://docs.enonic.com/en/stable/reference/libraries/index.html#js-libraries[Javascript Libraries]) to get the content and extract the _main_ region which was defined in the descriptor XML file.

+
.Page view:
[source,HTML]
----
include::../src/main/resources/site/pages/hello-region/hello-region.html[]
----
+

The view file above defines the place on the page where the region will render component parts that are dragged and dropped in the *Page Editor*.

. When done - redeploy your app once again!

  ./gradlew deploy

NOTE: You can restart XP in http://docs.enonic.com/en/stable/developer/projects/devmode.html#gradle-dev-mode[Development mode] and then the app won’t have to be redeployed after making changes.

=== Add your favorite country

Now that the _Country_ content type is installed (and we have a part to display them), we can create new countries using the *Content Studio* interface.

. Right-click on the _Hello World_ site from the navigation tree and select *New*. The *Create Content* dialogue will open.
. Select _Country_ from the list of content types.
. Fill in the form with the details of your favorite country.

Similar to the site, we must also configure a view for the country

[start=4]
. In the toolbar, in the top right corner of the page, click the image:images/icon-monitor.png[Menu icon, 30] button to activate the *Page Editor* (panel on the right-hand side with blue background).

image::images/country-content-edit.jpg["Country Content form", width=90%, align="center"]

[start=5]
. In the *Page Editor* select _Hello Region_ from the template selector dropdown. If the dropdown arrow is not visible, double-click inside the option field or start typing "_hello world_" in it to see the options.

The blue box with _Drop here_ is the region that we defined in the project code and it’s where we add components here in the *Page Editor*.

[start=6]
. Click the image:images/icon-cog.png[Cog icon, 30] button in the toolbar to open the *Inspection Panel* (far right).
. In the *Inspection Panel*, click the *Insert* tab. This reveals a list of default component types that can be placed into regions.
. Click and drag a new part (image:images/icon-part.png[Part icon, 30]) into the box on the page.
. A new dropdown option will appear. Select the _country_ part.
. Save draft and close the content edit tab.

When you click on the country in the content pane, you should see a preview of the rendered page, something like this:

image::images/country-content-rendered.jpg["Country Content rendered", width=90%, align="center"]

=== Page

With our current solution, sadly, we would have to create a new page for every country we add. As this is not a very effective way of working with large data sets, we will create a page template that will automatically render all country content.

. Select the Templates item image:images/icon-templates.png[Templates icon, 30] located below the _Hello World_ site in the content panel.
. Click *New* and select _Page Template_.
. Fill in the form as follows:

:: . Display Name: _Country_
:: . Supports: _Country_ (select from the list of content types)

. If the blue *Page Editor* panel is not displayed on the right, click the image:images/icon-monitor.png[Menu icon, 30] button in the toolbar.
. Select the _Hello Region_ controller with the dropdown in the blue *Page Editor* panel.
. Open the *Inspection Panel* (activated with the image:images/icon-cog.png[Cog icon, 30] button in the toolbar).
. Under the _Insert_ tab, drag and drop a new _part_ (image:images/icon-part.png[Part icon, 30]) into the empty region where it says _Drop here_.
. Select the _country_ part from the dropdown.
. Click _Save draft_ in the toolbar and close the tab.

Every _Country_ content you create from now on will use this template by default.

NOTE: The *Supports* property is the key. A page template will support rendering of the content types specified here.

Try this out by creating a few new countries in your site. Be aware that every content you create will be a child of the content that was selected in the content pane, so make sure you select the _Hello World_ site before clicking *New* in the toolbar. Or better yet, get in the habit of right-clicking the desired parent content and selecting *New* from the context menu. This way you will never accidentally create a content in the wrong place.

NOTE: Starting from *Enonic XP 6.11*, the *Detail Panel* on the far right of the *Browse View* has a little box showing the rendering mode. Compare your favorite country to other countries that are rendered automatically:

image::images/rendering-mode-view.png["Rendering mode", width=90%, align="center"]

=== Extra task

*Make your Favorite Country use the page template too!*

You might remember that your favorite country was “hardcoded” - so let’s change it to use templates as well.

. In the *Browse View* panel, double-click the country content to edit it.
. Open the *Inspection Panel* with the image:images/icon-cog.png[Cog icon, 30] button and select the *Inspect* tab if it’s not already selected.
. You should see a label for *Page Template* with _Custom_ selected and a label for *Page controller* with _Hello Region_ selected. If you see a label for *Part* instead then click on the page above the country name to select the page. Then click the *Inspect* tab. (See image below)
. Now select _Automatic_ from under the *Page Template* label in the *Inspect* tab.
. Save draft and close the tab.

image::images/page-template-automatic.jpg["Automatic Page Template", width=90%, align="center"]

You can select another *Page template* at any time, or even customize the presentation of a single content.


== Part 3: Configurable components

****
Welcome to part three. Here we will create a new content type for cities and a configurable component to display them. You will also learn how to make app configurations and you will get more practice with the *Content Studio*. Part three will conclude with content publishing and some advice and best practices.
****

=== Hello Geo World

The home page of the site now shows a list of the countries we have added. To make this even more exciting, we will add a _City_ content type with geo-location and a _City list_ part with configuration capabilities.

==== City content

The next steps will create a content type for adding cities with location coordinates.

. Create a folder named city inside the project’s ``site/content-types`` folder.
. Add the content type file below to your project. The file must be named `city.xml`, in accordance with the content type’s folder name (`city`).

+
.City content type:
[source,XML]
----
include::../src/main/resources/site/content-types/city/city.xml[]
----
+

The file above defines a content type for cities with a required field for the location in latitude and longitude.

. Copy the image below and save it in the same folder with the _City_ content type. Name it _city.png_.

image::images/city.png["City content type", width=100, align="center"]

==== City list part

We need a part component to display the city data. It will list the cities and show a Google map of each location.

. Create a folder named `city-list` inside the project’s `site/parts` folder.
. Add the part descriptor file. It must be named `city-list.xml`.

+
.City list part descriptor:
[source,XML]
----
include::../src/main/resources/site/parts/city-list/city-list.xml[]
----
+

The part descriptor above has a configuration similar to those found in content types.

. Add the part controller file. It must be named `city-list.js`.

+
.City list part controller:
[source,Javascript]
----
include::../src/main/resources/site/parts/city-list/city-list.js[]
----
+

There are a few things to note in this controller file. It gets the part configuration for zoom and map type which were defined in the part descriptor. It also gets the site configuration for the *Google Maps API* key which we will define later in the `site.xml` file. *Page Contributions* are used to put the *Google Maps* JavaScript into the head of the document.

. Add the part view file. It must be named `city-list.html` to match the `resolve` function in the controller.

+
.City list part view:
[source,HTML]
----
include::../src/main/resources/site/parts/city-list/city-list.html[]
----
+
There is just one more file to edit and then all the code for this project will be complete.


=== App configuration

*Google Maps* won’t work without an API key. We need somewhere to enter the key so that it can be accessed by any component that needs it. The perfect place to define a site-wide configuration is in the site descriptor.

. Replace the contents of the `site.xml` file at `site/site.xml` with the code below.
+
.Site descriptor:
[source,XML]
----
include::../src/main/resources/site/site.xml[]
----
+

The inputs defined in the site descriptor will appear in a form when editing the site content in the *Content Studio*.

. If you didn’t start XP in http://docs.enonic.com/en/stable/developer/projects/devmode.html#gradle-dev-mode[Development mode] then build and deploy your project one final time with `./gradlew deploy`.

All of the project’s files are now complete. The rest of the steps will be performed in the *Content Studio* interface.

[start=3]
. Edit the site content. You will notice that the `Myapp` application is now red due to a missing required configuration.
. Click the pencil icon to edit the `Myapp` configuration and enter your *Google API* key. You can get a *Google API* key from the Google developers site if you don’t already have one.

image::images/app-config.jpg["Myapp config", width=90%, align="center"]

=== City list part

Now let’s make use of the new city content type and part component. First we need to add the `City list` part to the `Country` page template.

. Edit the `Country` page template. Find it in the content pane below the templates image:images/icon-templates.png[Templates icon, 30]
. Open the *Inspect Panel* by clicking the image:images/icon-cog.png[Inspect panel, 30] button in the toolbar.
. Under the *Insert* tab, click and drag a _Part_ image:images/icon-part.png[Part, 30] to the page region below the _country_ part. (This may be a bit tricky because the _country_ part is small.) You could also right-click on the word _Country_ and then use the context menu to insert the part.
. Select the _City list_ part from the dropdown in the box.
. Save and close the tab.


=== Configure City List

The _City list_ part descriptor (`site/parts/city-list/city-list.xml`) has configuration inputs for the map type and zoom level. You can set the default values for these inputs by editing the `City list` part in the `Country page` template.

. Open the _Country page_ template for editing.
. Open the *Inspection Panel* by clicking the image:images/icon-cog.png[Inspect panel, 30] button in the toolbar.
. Click on the _City list_ part in the *Page Editor* panel.
. Under the *Inspect* tab of the *Inspection Panel*, set the Map type to _HYBRID_ and Zoom level to _12_.
. Save draft and close the edit tab.

Now all of the countries will show the city maps with the new settings. You can override these defaults for any individual country by editing the _Country_ content and changing its _City list_ part configuration.

image::images/city-list-config.jpg["City list", width=90%, align="center"]

=== Go Online

Now that your "Hello World" site is complete, it’s time to publish.

. Select the _Hello World_ site in the content browse panel
. Right-click and select *Publish* from the context menu, or click the *Publish* button in the toolbar
. The *Publishing Wizard* will appear. You may click the image:images/icon-children.png[Child items, 30] icon to see all child nodes that will also be published.
. Verify that all your items are listed and click *Publish*!

When publishing content, all the selected items and changes are “cloned” from *draft* to the *master* branch (http://docs.enonic.com/en/stable/developer/node-domain/repository.html#node-domain-repository[Repository]).

You will always see the draft version of content in the preview panel and the *Page Editor* of the *Content Studio*. If you have placed your site on root level, you can also see your live site at this url: `http://localhost:8080/portal/master/hello-world`.

Well done, you have just created *your first site for Enonic XP*! The Enonic team congratulates you - we look forward to seeing all the brilliant things you will make.

We are always looking for https://discuss.enonic.com/[feedback].

Now take a look at some Pro Tips.


=== Pro Tips

==== Adding libraries to your project

Why re-invent the wheel for each app you make? Reusable code can be created in libraries and added to any XP project. Some essential tools can be found in the https://github.com/enonic/lib-util[Util lib], https://github.com/enonic/lib-menu[Menu lib], https://github.com/enonic/lib-recaptcha[RECAPTCHA] and https://github.com/enonic/lib-landingpage[Landing page] libraries.

==== Adding apps to your site

A website can be created from a single app. But a site’s functionality can be extended by adding other pre-made apps. SEO Meta Fields, Disqus comments and Google Analytics are just a few of the many apps that can instantly add features to your site. See what’s available at the http://market.enonic.com/applications[Enonic Market].


==== Logging JSON objects

While developing an app, it can be helpful to see the structure of objects returned by library functions. The best way to do this is to set up a utilities JavaScript file in the project lib folder. Add the following function to the utilities file:

    site/lib/utilities.js

    exports.log = function (data) {
      log.info('Utilities log %s', JSON.stringify(data, null, 4));
    };

Call the log function in any controller like the example below and then check the log after refreshing the page.

    var util = require('utilities');

    var content = portal.getContent();
    util.log(content);

This logging function and many other useful functions are included in the https://github.com/enonic/lib-util[Util library].

==== Continuous build with Dev Mode or Gradle

It can be quite time consuming to frequently use the terminal to redeploy an app during development. Starting *Enonic XP* in _dev-mode_ will make most changes to your app code visible immediately on _localhost_. See the http://docs.enonic.com/en/stable/developer/projects/devmode.html#gradle-dev-mode[Development mode] page for more information about its capabilities and limitations.

Another option is to use `./gradlew -t deploy` in the terminal from the project root. This will automatically build and redeploy your app every time changes to a file are detected. This method is slower than dev-mode, but it handles some situations that dev-mode doesn’t. *Gradle 2.7* or newer is required.

Both dev-mode and Gradle continuous-mode require the `$XP_HOME` environment variable to be set in the terminal window.

== Next Steps

This tutorial only covered the basics of site development. Explore the documentation for more in-depth coverage.

Need help? Ask questions on our https://discuss.enonic.com/[forum] or answer questions from others.
